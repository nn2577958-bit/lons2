<script type="module">
// Firebase ëª¨ë“ˆ
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

// ğŸ”¹ Firebase ì„¤ì •
const firebaseConfig = {
  apiKey: "AIzaSyCyiAepd539cBTPwtcVnAR-HJbb8roLJmE",
  authDomain: "lons-dc24d.firebaseapp.com",
  projectId: "lons-dc24d",
  storageBucket: "lons-dc24d.appspot.com",
  messagingSenderId: "755692328918",
  appId: "1:755692328918:web:a4eb4563cb862d3eb5b677"
};

// Firebase ì´ˆê¸°í™”
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

// ìš”ì†Œ
const ADMIN_EMAIL = "nn2577958@gmail.com";
const adminStatus = document.getElementById("admin-status");
const googleBtn = document.getElementById("google-btn");
const discordBtn = document.getElementById("discord-btn");
const loginMsg = document.getElementById("login-msg");

let opacity = 1;
let fadingOut = true;

// ê´€ë¦¬ì ìƒíƒœ + ì‹œê³„ ì—…ë°ì´íŠ¸
function updateAdminClock(user){
  const now = new Date();
  const kstString = now.toLocaleString("ko-KR", { hour12:false, timeZone:"Asia/Seoul" });

  let isOnline = false;
  if(user?.email === ADMIN_EMAIL) isOnline = true;

  adminStatus.innerHTML = `${isOnline ? "ğŸŸ¢ ê´€ë¦¬ì ì˜¨ë¼ì¸" : "ğŸ”´ ê´€ë¦¬ì ì˜¤í”„ë¼ì¸"}<br>${kstString}`;

  // ê¹œë°•ì„ íš¨ê³¼
  if(fadingOut){ opacity -= 0.05; if(opacity<=0){ opacity=0; fadingOut=false;} }
  else { opacity += 0.05; if(opacity>=1){ opacity=1; fadingOut=true;} }
  adminStatus.style.opacity = opacity;
}

// ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€
onAuthStateChanged(auth, user => {
  updateAdminClock(user);

  if(user){
    discordBtn.classList.remove('disabled');
    discordBtn.removeAttribute('data-tooltip');
  } else {
    discordBtn.classList.add('disabled');
    discordBtn.setAttribute('data-tooltip','ë¡œê·¸ì¸ í›„ í™œì„±í™”ë©ë‹ˆë‹¤');
  }

  // ê¹œë°•ì„ ì‹œì‘ (ë¡œê·¸ì¸ ì—¬ë¶€ ìƒê´€ì—†ì´)
  setInterval(()=>updateAdminClock(user), 1000);
});

// êµ¬ê¸€ ë¡œê·¸ì¸
googleBtn.addEventListener("click", async ()=>{
  googleBtn.disabled = true;
  loginMsg.textContent = "";
  const provider = new GoogleAuthProvider();
  try{
    await signInWithPopup(auth, provider);
    loginMsg.textContent = "ë¡œê·¸ì¸ ì„±ê³µ! ë””ìŠ¤ì½”ë“œ ì°¸ì—¬í•˜ê¸° ë²„íŠ¼ì´ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.";
  } catch(err){
    loginMsg.textContent = "ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message;
    googleBtn.disabled = false;
  }
});

// ë””ìŠ¤ì½”ë“œ ë²„íŠ¼
discordBtn.addEventListener("click", ()=>{
  if(discordBtn.classList.contains('disabled')){
    loginMsg.textContent = "êµ¬ê¸€ ë¡œê·¸ì¸ í›„ ì°¸ì—¬í•˜ê¸° ë²„íŠ¼ì´ í™œì„±í™”ë©ë‹ˆë‹¤!";
    return;
  }
  loginMsg.textContent = "ì ì‹œ í›„ í™ˆìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...";
  setTimeout(()=>window.location.href="home.html",1500);
});
</script>
