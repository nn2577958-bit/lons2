<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ë¼ë‹ˆ MALL - í™ˆ</title>
<style>
body { margin:0; min-height:100vh; display:flex; justify-content:center; align-items:flex-start; font-family:'Segoe UI', sans-serif; background: linear-gradient(rgba(0,0,0,0.45), rgba(0,0,0,0.45)), url('https://cdn.phototourl.com/uploads/2026-02-18-2239f19c-5c7f-4c1e-b1c1-731bf5606151.webp') center/cover no-repeat; padding:40px 0; }
.container { text-align:center; width:100%; max-width:500px; padding:20px; background: rgba(0,0,0,0.35); border-radius:16px; }
#status, #welcome { color:white; margin-bottom:15px; font-weight:bold; }
.product { background:white; color:black; padding:15px; border-radius:12px; margin-bottom:12px; }
.product button { margin-top:8px; padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:#1976d2; color:white; }
#logout-btn { background:#d50000; color:white; padding:8px; width:120px; margin-top:20px; border:none; border-radius:8px; cursor:pointer; }
input { padding:6px; margin:4px; border-radius:6px; border:none; width:120px; }
#add-product-btn { padding:6px 10px; margin-top:8px; cursor:pointer; border-radius:6px; border:none; background:#4caf50; color:white; }
</style>
</head>
<body>

<div class="container">
  <div id="status">ğŸŸ¢ ì˜¨ë¼ì¸</div>
  <div id="welcome">ë¡œê·¸ì¸ í™•ì¸ ì¤‘...</div>

  <div id="product-list"></div>

  <input type="text" id="product-name" placeholder="ìƒí’ˆëª…">
  <input type="text" id="product-price" placeholder="ê°€ê²©">
  <button id="add-product-btn">ìƒí’ˆ ì¶”ê°€</button>

  <button id="logout-btn">ë¡œê·¸ì•„ì›ƒ</button>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { collection, addDoc, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const welcome = document.getElementById("welcome");
const productList = document.getElementById("product-list");

/* ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ */
onAuthStateChanged(auth, async user => {
  if(user){
    welcome.textContent = `í™˜ì˜í•©ë‹ˆë‹¤, ${user.email}`;
    await loadProducts();
  } else {
    window.location.href = "index.html";
  }
});

/* Firestore ìƒí’ˆ ë¶ˆëŸ¬ì˜¤ê¸° */
async function loadProducts(){
  productList.innerHTML = "";
  const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
  const snapshot = await getDocs(q);
  snapshot.forEach(doc => {
    const p = doc.data();
    const div = document.createElement("div");
    div.className = "product";
    const title = document.createElement("h3"); title.textContent = p.name;
    const price = document.createElement("p"); price.textContent = p.price;
    const btn = document.createElement("button");
    btn.onclick = () => alert(`${p.name} ë¬¸ì˜ëŠ” ë””ìŠ¤ì½”ë“œë¡œ ì£¼ì„¸ìš”.`);
    btn.textContent = "ë¬¸ì˜";
    div.append(title, price, btn);
    productList.appendChild(div);
  });
}

/* Firestore ìƒí’ˆ ì¶”ê°€ */
document.getElementById("add-product-btn").onclick = async () => {
  const name = document.getElementById("product-name").value;
  const price = document.getElementById("product-price").value;
  if(name && price){
    await addDoc(collection(db, "products"), { name, price, createdAt: new Date() });
    document.getElementById("product-name").value = "";
    document.getElementById("product-price").value = "";
    await loadProducts();
  }
};

/* ë¡œê·¸ì•„ì›ƒ */
document.getElementById("logout-btn").onclick = async () => {
  await signOut(auth);
  window.location.href = "index.html";
};

/* ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œ */
const statusElem = document.getElementById("status");
function updateStatus(){
  const now = new Date();
  const kst = now.toLocaleString("ko-KR",{hour12:false,timeZone:"Asia/Seoul"});
  statusElem.textContent = `ğŸŸ¢ ì˜¨ë¼ì¸ | ${kst}`;
}
updateStatus();
setInterval(updateStatus,1000);
</script>
</body>
</html>
