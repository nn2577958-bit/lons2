<script type="module">
import { db, auth } from "./firebase.js";
import { collection, addDoc, getDocs, orderBy, serverTimestamp, query } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const postsContainer=document.getElementById("posts-container");
const postBtn=document.getElementById("post-btn");
const authorInput=document.getElementById("author");
const titleInput=document.getElementById("title");
const contentInput=document.getElementById("content");

async function loadPosts(){
  postsContainer.innerHTML="";
  const q=query(collection(db,"posts"),orderBy("createdAt","desc"));
  const snapshot=await getDocs(q);
  snapshot.forEach(doc=>{
    const data=doc.data();
    const div=document.createElement("div");
    div.className="notice-item";
    div.innerHTML=`<strong>${data.title}</strong> <small>${new Date(data.createdAt?.seconds*1000).toLocaleString()}</small><div>${data.content}</div>`;
    postsContainer.appendChild(div);
  });
}

postBtn.addEventListener("click",async()=>{
  const author=authorInput.value.trim();
  const title=titleInput.value.trim();
  const content=contentInput.value.trim();
  if(!author||!title||!content)return alert("모든 필드를 입력해주세요!");
  await addDoc(collection(db,"posts"),{
    author,title,content,createdAt:serverTimestamp()
  });
  authorInput.value=""; titleInput.value=""; contentInput.value="";
  loadPosts();
});

loadPosts();
</script>
