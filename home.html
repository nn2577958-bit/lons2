<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyBeoiT7Bh0r83YY4Ga52auTmA5X92DMzKQ",
  authDomain: "lons2-74bfa.firebaseapp.com",
  projectId: "lons2-74bfa",
  storageBucket: "lons2-74bfa.appspot.com",
  messagingSenderId: "734178165313",
  appId: "1:734178165313:web:395ed759777ec61f4b3cc0"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
console.log("Firebase Initialized");

const ADMIN_EMAIL="nn2577958@gmail.com";

const adminStatus = document.getElementById("admin-status");
const noticeList = document.getElementById("notice-list");
const kakaoBtn = document.getElementById("kakao-btn");
const discordBtn = document.getElementById("discord-btn");
const logoutBtn = document.getElementById("logout-btn");
const modal = document.getElementById("pc-modal");

const notices = [
  {title:"ê³µì§€ ì‚¬í•­",content:"í•­ìƒ ëª¨ë‹ˆí„°ë§ ì¤‘ì´ë©° ëª¨ë“  íŒŒì¼ì€ ë°ì´í„° ë² ì´ìŠ¤ì— ê¸°ë¡ ë©ë‹ˆë‹¤.",createdAt:"2026-02-17 12:00~12:10"},
  {title:"ì‹ ê·œ ë½‘ê¸° ì´ë²¤íŠ¸ ì‹œìž‘!",content:"ë‹¹ì²¨ë˜ì‹  ë¶„ë“¤ì€ ìš”ì²­ ì£¼ì‹œë©´ ì§€ê¸‰ ì²˜ë¦¬ë©ë‹ˆë‹¤.",createdAt:"2026-02-16 14:00"},
  {title:"ì—…ë°ì´íŠ¸ ì™„ë£Œ",content:"PAL 0.7.2 ìµœì‹  íŒ¨ì¹˜ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.",createdAt:"2026-02-16 14:30"},
  {title:"SV ì˜¤í”ˆ ë‚ ì§œ",content:"2026 01.12",createdAt:"2026-01-12 01:00"},
  {title:"ì§€ì›ê¸ˆ ì•ˆë‚´",content:"ëª¨ë“  ì§€ì›ê¸ˆì€ ìš´ì˜ë¹„ì— ì“°ì´ê³  ìžˆìŠµë‹ˆë‹¤,",createdAt:"2026-02-16 14:30"},
  {title:"ì„œë²„ ì ‘ì† ìƒí™©",content:"1SV / 2SV ëª¨ë‘ ì •ìƒ ìž‘ë™ ì¤‘ìž…ë‹ˆë‹¤.",createdAt:"2026-02-16 00:00"},
  {title:"ì„œë²„ ì˜¤í”ˆ ì•ˆë‚´",content:"í•˜ë“œì½”ì–´ 02 / 20 å¤§ ì˜¤í”ˆ ë§Žì´ ì‚¬ëž‘ í•´ì£¼ì„¸ìš”!",createdAt:"2026-02-20 12:00"}
];

onAuthStateChanged(auth, (user) => {
  if(!user){ window.location.href="index.html"; return; }

  if(user.email === ADMIN_EMAIL){
      function updateAdminStatus(){
          const now = new Date();
          const kstString = now.toLocaleString("ko-KR", { hour12:false, timeZone:"Asia/Seoul" });
          adminStatus.innerHTML = `ðŸŸ¢ ê´€ë¦¬ìž ì˜¨ë¼ì¸ â€“ ${kstString} (ì˜¤í”„ë¼ì¸/ì˜¨ë¼ì¸ ë˜ë©´ ìžë™ìœ¼ë¡œ ì‹œê°„ ë°˜ì˜ë©ë‹ˆë‹¤)`;
      }
      updateAdminStatus();
      setInterval(updateAdminStatus, 1000);

      setInterval(()=>{
          adminStatus.style.opacity = adminStatus.style.opacity === "0" ? "1" : "0";
      }, 800);

      adminStatus.style.background = "#28a745";
  } else {
      adminStatus.innerHTML = "ðŸ”´ ê´€ë¦¬ìž ì˜¤í”„ë¼ì¸ (ì˜¤í”„ë¼ì¸/ì˜¨ë¼ì¸ ë˜ë©´ ìžë™ìœ¼ë¡œ ì‹œê°„ ë°˜ì˜ë©ë‹ˆë‹¤)";
      adminStatus.style.background = "#dc3545";
      adminStatus.style.opacity = "1";
  }

  noticeList.innerHTML = "";
  notices.forEach(data => {
      const div = document.createElement("div");
      div.className = "notice-item";
      div.innerHTML = `
          <strong>${data.title}</strong>
          <small>${data.createdAt}</small>
          <div>${data.content}</div>
      `;
      noticeList.appendChild(div);
  });
});

// ë¡œê·¸ì•„ì›ƒ
logoutBtn.onclick = async () => {
  await signOut(auth);
  window.location.href="index.html";
};

// Discord ë²„íŠ¼
discordBtn.onclick = () => window.open("https://discord.gg/tnMXbQ65Hk","_blank");

// Pay ë²„íŠ¼
kakaoBtn.onclick = () => {
  const ua = navigator.userAgent || navigator.vendor || window.opera;
  const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
  if(isMobile){
      window.location.href="https://qr.kakaopay.com/FRydbZ6Gr";
  } else {
      modal.style.display = "flex";
  }
};

// ëª¨ë‹¬ ë‹«ê¸°
window.closeModal = () => modal.style.display="none";
</script>
